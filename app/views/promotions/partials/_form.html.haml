- promotion ||= @promotion
- organization ||= promotion.content.organization unless promotion.nil?
- ajax_submit ||= false
- if organization.present?
  %p Advertiser: #{link_to organization.name, edit_organization_path(organization)}
= simple_form_for (promotion.id ? promotion : [organization, promotion]) do |f|
  = f.error_notification
  .form-inputs
    %p="Title: #{promotion.content.title}"
    = f.input :description, required: true, input_html: { class: "input-block-level", rows: 5 }
    = f.input :paid
    = f.simple_fields_for :promotable do |p|
      - if promotion.promotable.is_a? PromotionBanner
        = p.input :promotion_type, collection: PromotionBanner::PROMOTION_TYPES, label: 'Ad type'
        = p.input :boost
        = p.input :campaign_start, as: :date_picker, label: 'Creative Start Date'
        = p.input :campaign_end, as: :date_picker, label: 'Creative End Date'
        = p.input :daily_max_impressions, label: 'Daily Maximum Impressions'
        = p.input :max_impressions, label: 'Maximum Impressions'
        = p.input :cost_per_impression
        = p.input :cost_per_day
        = p.input :coupon_email_body, as: :text, label: 'Coupon Details'

        - if promotion.promotable.coupon_image?
          = p.input :remove_coupon_image, as: :boolean, label: "Remove coupon image?"
          = image_tag(promotion.promotable.coupon_image_url) if promotion.promotable.coupon_image_url.present?
        = p.input :coupon_image, as: :file, label: 'Coupon Image (aspect ratio: w360xh640)'

    - if promotion.promotable.present?
      = f.input :promotable_type, as: :hidden

    = f.simple_fields_for :promotable do |g|
      - if promotion.promotable.is_a? PromotionListserv
        = g.association :listserv
      - elsif promotion.promotable.is_a? PromotionBanner
        - if promotion.promotable_banner_image?
          = image_tag(promotion.promotable_banner_image.url, id: "promotion-current-banner-image") if promotion.promotable_banner_image.url.present?
        - else
          = image_tag "", id: 'promotion-preview-image'
        = g.input :banner_image, label: 'Creative Image'
        - if @promotion.present? && (@promotion.promotable_type == 'PromotionBanner' && promotion.promotable.promotion_type == PromotionBanner::COUPON)
          %p= "Coupon Redirect is: #{@promotion.promotable.redirect_url}"
        - else
          = g.input :redirect_url, label: 'Redirect URL (overridden if Ad Type = Coupon)', input_html: { class: "input-block-level" }
    = f.input :content_id, as: :hidden

  .form-actions
    - if ajax_submit
      %span.btn.btn-primary.create-new-promotion{ data: { submit_url: organization_promotions_path(organization) } } Create Promotion
    - else
      = f.button :submit, class: "btn-primary btn"
    = link_to "Cancel", 'javascript:history.back()', class: "btn"
