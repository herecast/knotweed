= simple_form_for @business_profile, html: { class: "event-form form" } do |f|
  = f.error_notification
  .tabbable
    %ul.nav.nav-tabs.nav-tabs-simple#edit_doctabs
      %li#business_profile_tab_link{ class: "active" }
        = link_to "#", class: "green-border", data: { toggle: "tab", target: "#business_details" } do
          %i.icon-reorder
          Business Details
      %li.pull-right
        %span.btn.btn-small.tab-traversal-link{ data: { move_index: "-1" } } Previous
        %span.btn.btn-small.tab-traversal-link{ data: { move_index: "1" } } Next
    .tab-content
      .tab-pane.form-horizontal#business_details{ class: 'active' }
        = f.simple_fields_for :business_location do |g|
          .row-fluid
            .span6
              .row-fluid
                = g.input :name, input_html: { class: 'span12' }, wrapper_html: { class: 'span12' }
              .row-fluid
                = g.input :venue_url, label: 'Website',input_html: { class: 'span12' },
                  wrapper_html: { class: 'span12' }
              .row-fluid
                = g.input :address, input_html: { class: 'span12' }, wrapper_html: { class: 'span12' }
              .row-fluid
                = g.input :city, input_html: { class: 'span12' }, wrapper_html: { class: 'span12' }
              .row-fluid
                = g.input :state, input_html: { class: 'span12' }, wrapper_html: { class: 'span6' }
              .row-fluid
                = g.input :zip, input_hml: { class: 'span12' }, wrapper_html: { class: 'span6' }
                = g.input :phone, input_html: { class: 'span12' }, wrapper_html: { class: 'span6' }
              .row-fluid
                = g.input :email, input_html: { class: 'span12' }, wrapper_html: { class: 'span12' }
            .span6
              %span.pull-right.btn.btn-primary#locate_on_map_button{data: {remote: 'true'}} Locate on Map
              - bl = @business_profile.business_location
              - if bl.address.present?
                - addr = CGI::escape "#{bl.address} #{bl.city} #{bl.state} #{bl.zip}"
                %iframe#confirm_location_map{ data: { base_src_url: "https://www.google.com/maps/embed/v1/place?key=#{Figaro.env.gmaps_api_key}&q=" },
                  src: "https://www.google.com/maps/embed/v1/place?key=#{Figaro.env.gmaps_api_key}&q=#{addr}" }
              - else
                %iframe#confirm_location_map{ data: { base_src_url: "https://www.google.com/maps/embed/v1/place?key=#{Figaro.env.gmaps_api_key}&q=" } }
        .row-fluid
          = f.association :business_categories, input_html: { class: 'chosen-select input-block-level' }
        = f.simple_fields_for :business_location do |g|
          .row-fluid
            %h3 Opening Hours
            %span.hint 
              Each rule needs to be in 
              = link_to 'Schema.org OpeningHours format', 'https://schema.org/openingHours'
              Ex. 'Mo-Th 16:00-20:00'
            %span.pull-left.btn.btn-success.add-hours-link + Add Hours
          #business_location_hours
            = g.fields_for :hours do |i|
              - if @business_profile.business_location.hours.present?
                - @business_profile.business_location.hours.each do |hour|
                  .row-fluid
                    .span6
                      = i.text_field nil, value: hour, class: 'span12'
                    .span2.offset4
                      .btn.btn-danger.remove-hours-field X

    .form-actions
      = submit_tag nil, class: "btn btn-primary"
      = submit_tag "Submit and continue with this record", class: "btn btn-success", name: "continue_editing"
      - if @next_content_id.present?
        = hidden_field_tag :next_record_id, @next_content_id
        = hidden_field_tag :index, @next_index
        = hidden_field_tag :page, params[:page]
        = submit_tag "Submit and go to next record", class: "btn btn-success", name: "next_record"
      = submit_tag "Submit and add new", class: "btn btn-success", name: "create_new"
      = link_to "Cancel", :back, class: "btn cancel"
